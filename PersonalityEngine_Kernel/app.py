@app.post("/report", response_class=HTMLResponse)
def render_report(payload: InferenceRequest):
    if not payload.responses:
        raise HTTPException(status_code=400, detail="No responses provided")

    engine_input = build_engine_input(payload)
    result = run_inference(engine_input)

    s = result["kernel_output"]["signal_summary"]

    html = f"""
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PEK Lite — Personality Snapshot</title>
<style>
body {{
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial;
    background: #0e0e11;
    color: #eaeaf0;
    padding: 60px 20px;
}}
.container {{
    max-width: 880px;
    margin: auto;
    background: #16161c;
    padding: 48px;
    border-radius: 14px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.6);
}}
h1 {{
    margin-bottom: 6px;
    font-size: 2.2rem;
}}
.sub {{
    color: #9aa0b4;
    margin-bottom: 36px;
}}
h2 {{
    margin-top: 44px;
    font-size: 1.4rem;
}}
p {{
    line-height: 1.75;
    margin-top: 14px;
}}
.section {{
    border-top: 1px solid #2a2a36;
    padding-top: 32px;
    margin-top: 32px;
}}
.footer {{
    margin-top: 48px;
    font-size: 0.85rem;
    color: #8a8fa3;
    text-align: center;
}}
</style>
</head>
<body>
<div class="container">

<h1>Personality Engine Kernel — Lite</h1>
<div class="sub">Behavioral & cognitive pattern analysis</div>

<div class="section">
<h2>Orientation Snapshot</h2>
<p>
Your responses indicate a person who carries responsibility internally, processes complexity before acting,
and regulates pressure through containment rather than outward release.
This is not indecision — it is internal load management.
</p>

<p>
You appear to rely on your own judgment more than external reassurance,
especially when situations feel uncertain or stakes are high.
This often results in calm outward behavior even when internal processing is active.
</p>
</div>

<div class="section">
<h2>How This Pattern Typically Forms</h2>
<p>
This pattern commonly develops in people who learned early that outcomes depended on them.
Rather than offloading stress, you adapted by increasing internal control,
cognitive rehearsal, and self-reliance.
</p>

<p>
Over time, this creates a strong internal operating system —
but it also means pressure accumulates quietly instead of dissipating socially.
</p>
</div>

<div class="section">
<h2>Real-World Expression</h2>
<p>
In daily life, this shows up as reliability, composure, and delayed decision-making.
You may take longer to act, but once you do, actions are usually well-considered.
</p>

<p>
Others may underestimate how much you are carrying simply because you do not externalize it.
</p>
</div>

<div class="section">
<h2>Strengths</h2>
<p>
Your primary strengths are self-regulation, cognitive endurance, and the ability to function under sustained pressure.
You are difficult to destabilize emotionally and tend to remain operational when others fragment.
</p>
</div>

<div class="section">
<h2>Common Misinterpretations</h2>
<p>
This pattern is often misread as passivity, emotional distance, or lack of urgency.
In reality, activity is occurring internally — just not visibly.
</p>
</div>

<div class="section">
<h2>Reflection Prompts</h2>
<p>
Notice when internal processing is genuinely useful — and when sharing responsibility would reduce unnecessary load.
</p>

<p>
Ask yourself whether containment is still serving you in situations where collaboration is possible.
</p>
</div>

<div class="footer">
Generated by PEK Lite · Full PEK system coming soon
</div>

</div>
</body>
</html>
"""
    return html
